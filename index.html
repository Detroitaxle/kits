<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kit Refund Calculator â€” Detroit Axle</title>
  <link rel="icon" href="favicon.ico" />
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
  <style>
    /* Basic dark theme matching the screenshot */
    :root{
      --bg:#0f0f10; --panel:#1d1d1e; --muted:#2a2a2b; --card:#222; --accent:#ff6f1a; --accent-2:#ff8b3a; --green:#06c36a; --text:#e9e7e6;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#0b0b0c,#0f0f10);font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:var(--text);}
    .wrap{max-width:1200px;margin:24px auto;padding:18px;display:grid;grid-template-columns:1fr 420px;gap:20px}

    /* Left column */
    .panel{background:var(--panel);border-radius:8px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,.6);}
    h2{margin:0 0 12px 0;color:var(--accent)}
    label.small{display:block;font-size:12px;color:#ddd;margin-bottom:6px}
    .input, input[type="text"], input[type="number"]{background:#232323;border:1px solid #252525;padding:10px 12px;border-radius:6px;color:var(--text);width:100%;box-sizing:border-box}
    .kit-top{margin-bottom:12px}

    .parts-list{background:linear-gradient(180deg,#1a1a1b,#181818);padding:12px;border-radius:8px;border:1px solid #2b2b2b}
    .part-row{display:grid;grid-template-columns:28px 64px 1fr 120px;gap:10px;align-items:center;padding:10px;border-radius:6px;border-bottom:1px solid rgba(255,255,255,.02)}
    .part-row:last-child{border-bottom:0}
    .checkbox-wrap{display:flex;justify-content:center}
    .qty{max-width:56px}

    /* Remove number input arrows */
    input[type=number]::-webkit-outer-spin-button, input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance:textfield; }

    .controls{display:flex;gap:10px;margin-top:12px}
    .btn{background:var(--accent);color:#111;padding:10px 14px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
    .btn.ghost{background:#2a2a2a;color:var(--text)}

    /* Right column */
    .summary .card{background:#222;border-radius:8px;padding:14px;margin-bottom:14px}
    .row{display:flex;justify-content:space-between;align-items:center}
    .muted{color:#bfbfbf;font-size:13px}
    .big-green{background:linear-gradient(180deg,#05c36a,#03a655);border-radius:8px;padding:22px;text-align:center;color:#042617;box-shadow:0 10px 30px rgba(6,195,106,.14);margin:12px 0}
    .big-green h3{margin:0;font-size:20px}
    .big-green .amount{font-size:40px;font-weight:800;margin-top:8px}

    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:10px;font-size:13px;text-align:left}
    th{background:#0f0f0f;color:var(--accent);font-weight:700;border-bottom:1px solid rgba(255,255,255,.03)}
    td{background:#141414;border-bottom:1px solid rgba(255,255,255,.02)}

    .small-muted{font-size:12px;color:#bdbdbd}

    /* responsive */
    @media (max-width:1100px){.wrap{grid-template-columns:1fr}.panel{padding:12px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel left">
      <h2>Kit Information</h2>
      <div class="kit-top">
        <label class="small">Full Kit Price After Discount (Pk)</label>
        <input id="kitPrice" class="input" type="number" min="0" step="0.01" value="" placeholder="0.00" />
      </div>

      <div class="parts-list" id="partsList">
        <!-- part rows inserted by JS -->
      </div>

      <div style="display:flex;justify-content:space-between;margin-top:12px">
        <button class="btn" id="addPart">Add More Parts</button>
        <button class="btn ghost" id="clearAll">Clear All</button>
      </div>
    </div>

    <div class="panel summary">
      <h2>Calculation Results</h2>
      <div class="card">
        <div class="row"><div class="muted">Total Kit List Price (SUM):</div><div id="sumTotal">$0.00</div></div>
        <div class="row" style="margin-top:8px"><div class="muted">Actual Kit Price (Pk):</div><div id="actualKit">$0.00</div></div>
        <div class="row" style="margin-top:8px"><div class="muted">Discount Applied:</div><div id="discountApplied">$0.00 (0.0%)</div></div>
      </div>

      <div class="card">
        <div class="row"><div class="muted">Parts Checked:</div><div id="partsChecked">0</div></div>
        <div class="row" style="margin-top:8px"><div class="muted">Total Refund Value:</div><div id="totalRefund">$0.00</div></div>
      </div>

      <div class="big-green">
        <h3>Total Refund for Checked Parts</h3>
        <div class="amount" id="bigRefund">$0.00</div>
        <div class="small-muted">Based on proportional allocation</div>
      </div>

      <div class="card">
        <h3 style="margin-top:0;color:var(--accent)">Individual Piece Prices</h3>
        <table id="priceTable">
          <thead>
            <tr><th>Part Number</th><th>Unit Price</th><th>Extended Price</th><th>Allocated Unit</th><th>Allocated Ext.</th></tr>
          </thead>
          <tbody>
            <!-- rows inserted by JS -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Start with 8 rows
    const INITIAL_ROWS = 8;
    const MAX_ROWS = 200;

    const partsList = document.getElementById('partsList');
    const addBtn = document.getElementById('addPart');
    const clearBtn = document.getElementById('clearAll');
    const kitPriceInput = document.getElementById('kitPrice');

    const sumTotalEl = document.getElementById('sumTotal');
    const actualKitEl = document.getElementById('actualKit');
    const discountAppliedEl = document.getElementById('discountApplied');
    const partsCheckedEl = document.getElementById('partsChecked');
    const totalRefundEl = document.getElementById('totalRefund');
    const bigRefundEl = document.getElementById('bigRefund');
    const priceTableBody = document.querySelector('#priceTable tbody');

    function money(v){
      return (typeof v==='number' ? v : Number(v||0)).toLocaleString('en-US',{style:'currency',currency:'USD'});
    }

    function createRow(id, partNumber='', price=0, qty=1){
      const row = document.createElement('div');
      row.className = 'part-row';
      row.dataset.id = id;
      row.innerHTML = `
        <div class="checkbox-wrap"><input type="checkbox" class="chk" /></div>
        <div><input class="qty" type="number" min="1" step="1" value="${Number(qty)||1}" /></div>
        <div><input class="partnum" type="text" placeholder="Part Number" value="${escapeHtml(partNumber)}" /></div>
        <div><input class="unit" type="number" min="0" step="0.01" placeholder="0.00" value="${price ? Number(price).toFixed(2) : ''}" /></div>
      `;

      partsList.appendChild(row);

      // attach listeners
      const unitInput = row.querySelector('.unit');
      const qtyInput = row.querySelector('.qty');
      const partInput = row.querySelector('.partnum');
      const chkInput = row.querySelector('.chk');

      ['input','change'].forEach(evt=>{
        unitInput.addEventListener(evt, computeAll);
        qtyInput.addEventListener(evt, computeAll);
        partInput.addEventListener(evt, computeAll);
        chkInput.addEventListener(evt, computeAll);
      });

      // select all on focus so user can just type to replace
      unitInput.addEventListener('focus', (e)=>{ try{ e.target.select(); }catch(e){} });
      qtyInput.addEventListener('focus', (e)=>{ try{ e.target.select(); }catch(e){} });

      return row;
    }

    function escapeHtml(s){
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
    }

    function rebuildTable(items, f){
      priceTableBody.innerHTML = '';
      items.forEach(it=>{
        const tr = document.createElement('tr');
        const allocatedUnit = (it.unit * f) || 0;
        const allocatedExt = allocatedUnit * it.qty;
        tr.innerHTML = `<td>${escapeHtml(it.part || '')}</td>
                        <td>${money(it.unit)}</td>
                        <td>${money(it.unit * it.qty)}</td>
                        <td>${money(allocatedUnit)}</td>
                        <td>${money(allocatedExt)}</td>`;
        priceTableBody.appendChild(tr);
      });
    }

    function computeAll(){
      // gather data
      const rows = Array.from(document.querySelectorAll('.part-row'));
      const items = rows.map(r=>{
        const part = r.querySelector('.partnum').value.trim();
        const unit = parseFloat(r.querySelector('.unit').value) || 0;
        const qty = parseInt(r.querySelector('.qty').value) || 0;
        const checked = r.querySelector('.chk').checked;
        return {part,unit,qty,checked};
      });

      const S = items.reduce((acc,it)=>acc + (it.unit * it.qty),0);
      const Pk = parseFloat(kitPriceInput.value) || 0;
      const f = (S > 0) ? (Pk / S) : 0; // proportional multiplier

      // totals
      const discountedKitTotal = Pk;
      const discountAmount = S - discountedKitTotal;
      const discountPercent = S>0 ? (discountAmount / S) : 0;

      sumTotalEl.textContent = money(S);
      actualKitEl.textContent = money(Pk);
      discountAppliedEl.textContent = `${money(discountAmount)} (${(discountPercent*100).toFixed(1)}%)`;

      // individual allocations
      rebuildTable(items, f);

      // refund calc for checked items
      const checkedItems = items.filter(i=>i.checked);
      const partsCheckedCount = checkedItems.length;
      const totalRefund = checkedItems.reduce((acc,it)=> acc + ((it.unit * f) * it.qty), 0);

      partsCheckedEl.textContent = partsCheckedCount;
      totalRefundEl.textContent = money(totalRefund);
      bigRefundEl.textContent = money(totalRefund);
    }

    // initialize rows
    for(let i=0;i<INITIAL_ROWS;i++) createRow(i+1);
    computeAll();

    addBtn.addEventListener('click', ()=>{
      const current = document.querySelectorAll('.part-row').length;
      if(current >= MAX_ROWS) return;
      createRow(current+1);
      computeAll();

      // show a small flash effect on the newly added row (optional)
    });

    clearBtn.addEventListener('click', ()=>{
      kitPriceInput.value = '0.00';
      partsList.innerHTML='';
      for(let i=0;i<INITIAL_ROWS;i++) createRow(i+1);
      computeAll();
    });

    kitPriceInput.addEventListener('input', computeAll);
    kitPriceInput.addEventListener('focus', (e)=>{ try{ e.target.select(); }catch(e){} });

    // convenience: click on any table row toggles the corresponding checkbox if part number matches
    priceTableBody.addEventListener('click', (e)=>{
      // noop
    });

    // keep realtime
    partsList.addEventListener('input', computeAll);
    partsList.addEventListener('change', computeAll);

    // small accessibility: pressing Enter on Add More creates row
    addBtn.addEventListener('keyup', (e)=>{ if(e.key==='Enter') addBtn.click();});
  </script>
</body>
</html>
